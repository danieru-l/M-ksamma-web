<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lector de Máksamma | Capítulos Gratuitos</title>
    <meta name="description"
        content="Lee los primeros capítulos de Máksamma gratis. Experiencia de lectura inmersiva online.">

    <!-- Open Graph -->
    <meta property="og:title" content="Lector de Máksamma | Capítulos Gratuitos">
    <meta property="og:description"
        content="Lee los primeros capítulos de Máksamma gratis. Experiencia de lectura inmersiva online.">
    <meta property="og:image" content="images/PORTADA.png">
    <meta property="og:type" content="website">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Lector de Máksamma | Capítulos Gratuitos">
    <meta name="twitter:description" content="Lee los primeros capítulos de Máksamma gratis.">
    <meta name="twitter:image" content="images/PORTADA.png">

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="images/Maquiria.png">

    <!-- Fuentes -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Inter:wght@300;400;600&display=swap"
        rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body {
            background-color: #050508;
            color: #e2e8f0;
            font-family: 'Inter', sans-serif;
            margin: 0;
            overflow: hidden;
            touch-action: manipulation;
        }

        .font-epic {
            font-family: 'Cinzel', serif;
        }

        /* Fondo de estrellas sutil */
        .stars-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: radial-gradient(ellipse at bottom, #090a0f 0%, #050508 100%);
        }

        /* Contenedor del Libro */
        .book-container {
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            position: relative;
            perspective: 2000px;
        }

        /* Estilo de la Página */
        .page-wrapper {
            position: relative;
            height: 90%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.6s cubic-bezier(0.645, 0.045, 0.355, 1);
            transform-style: preserve-3d;
        }

        .page-image {
            max-height: 100%;
            max-width: 100%;
            height: auto;
            width: auto;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.8);
            user-select: none;
            -webkit-user-drag: none;
            background-color: #000;
            backface-visibility: hidden;
        }

        /* Efecto Doblez */
        .turn-next {
            transform: rotateY(-20deg) translateX(-30px);
            opacity: 0;
        }

        .turn-prev {
            transform: rotateY(20deg) translateX(30px);
            opacity: 0;
        }

        /* Zonas de Interacción */
        .tap-zone {
            position: absolute;
            top: 0;
            height: 100%;
            z-index: 20;
            cursor: pointer;
        }

        .tap-prev {
            left: 0;
            width: 30%;
        }

        .tap-center {
            left: 30%;
            width: 40%;
        }

        .tap-next {
            right: 0;
            width: 30%;
        }

        /* UI Inmersiva */
        header {
            transition: transform 0.4s ease, opacity 0.4s ease;
            transform: translateY(0);
        }

        .progress-bar-container {
            transition: transform 0.4s ease, opacity 0.4s ease;
            transform: translateY(0);
        }

        .ui-hidden header {
            transform: translateY(-100%);
            opacity: 0;
            pointer-events: none;
        }

        .ui-hidden .progress-bar-container {
            transform: translateY(100%);
            opacity: 0;
            pointer-events: none;
        }

        /* Barra de progreso inferior */
        .progress-bar-container {
            height: 4px;
            background: rgba(255, 255, 255, 0.05);
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            z-index: 50;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, #4a7cf5, #c5a059);
            width: 0%;
            transition: width 0.4s ease;
        }

        /* Spread para PC */
        .spread-view {
            display: flex;
            gap: 4px;
            height: 100%;
            align-items: center;
        }

        /* CTA Overlay */
        .cta-overlay {
            position: fixed;
            inset: 0;
            z-index: 60;
            background: rgba(0, 0, 0, 0.92);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 2rem;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
        }

        .cta-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        .cta-btn {
            display: inline-block;
            padding: 1rem 2.5rem;
            background: linear-gradient(135deg, #c5a059, #e8c97a);
            color: #0a0b10;
            font-family: 'Cinzel', serif;
            font-weight: 700;
            font-size: 0.85rem;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            border-radius: 4px;
            text-decoration: none;
            transition: all 0.3s;
        }

        .cta-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(197, 160, 89, 0.4);
        }
    </style>
</head>

<body class="ui-hidden">

    <div class="stars-bg"></div>

    <!-- CABECERA INMERSIVA -->
    <header
        class="fixed top-0 w-full h-16 flex items-center justify-between px-6 bg-black/80 backdrop-blur-lg border-b border-white/5 z-40">
        <a href="index.html"
            class="w-1/3 text-[10px] font-bold tracking-[0.2em] text-gray-400 hover:text-white transition flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
            </svg>
            SALIR
        </a>

        <div class="w-1/3 flex justify-center">
            <picture>
                <img src="images/LogoMaks.png" alt="Máksamma" class="h-10 md:h-12 w-auto object-contain">
            </picture>
        </div>

        <div class="w-1/3 text-right text-[10px] font-bold text-gray-400 tracking-widest" id="page-indicator">
            1 / 84
        </div>
    </header>

    <!-- ÁREA DE LECTURA -->
    <main class="book-container" id="book-area">
        <div class="tap-zone tap-prev" onclick="prevPage()"></div>
        <div class="tap-zone tap-center" onclick="toggleUI()"></div>
        <div class="tap-zone tap-next" onclick="nextPage()"></div>

        <div class="page-wrapper" id="reader-view">
            <!-- Las imágenes se cargan dinámicamente aquí -->
        </div>
    </main>

    <!-- PROGRESO -->
    <div class="progress-bar-container">
        <div class="progress-fill" id="progress-bar"></div>
    </div>

    <!-- CTA COMPRAR CAPÍTULO 4 -->
    <div class="cta-overlay" id="cta-overlay">
        <p class="text-gray-500 text-xs uppercase tracking-[0.3em] mb-4">Has terminado los capítulos gratuitos</p>
        <h2 class="font-epic text-3xl md:text-5xl text-white mb-4">¿Quieres seguir leyendo?</h2>
        <p class="text-gray-400 text-sm md:text-base max-w-md mb-8">Continúa la aventura de Máksamma adquiriendo el
            Capítulo IV y los siguientes en nuestra tienda.</p>
        <a href="tienda.html" class="cta-btn">Comprar Capítulo IV</a>
        <button onclick="closeCTA()"
            class="mt-6 text-gray-600 text-xs hover:text-gray-400 transition uppercase tracking-widest">Volver al
            lector</button>
    </div>

    <script>
        const totalPages = 84;
        let currentPage = 1;
        const readerView = document.getElementById('reader-view');
        const pageIndicator = document.getElementById('page-indicator');
        const progressBar = document.getElementById('progress-bar');
        let isUIVisible = false;

        function isMobile() {
            return window.innerWidth < 1024;
        }

        function toggleUI() {
            isUIVisible = !isUIVisible;
            if (isUIVisible) {
                document.body.classList.remove('ui-hidden');
            } else {
                document.body.classList.add('ui-hidden');
            }
        }

        function renderPages(directionClass) {
            directionClass = directionClass || '';
            if (directionClass) {
                readerView.classList.add(directionClass);
            }

            setTimeout(function () {
                readerView.innerHTML = '';
                readerView.className = 'page-wrapper';

                if (isMobile()) {
                    var img = createPageImg(currentPage);
                    readerView.appendChild(img);
                    pageIndicator.innerText = currentPage + ' / ' + totalPages;
                } else {
                    if (currentPage > 1 && currentPage % 2 === 0) currentPage--;

                    var spread = document.createElement('div');
                    spread.className = 'spread-view';

                    var leftImg = createPageImg(currentPage);
                    spread.appendChild(leftImg);

                    if (currentPage + 1 <= totalPages) {
                        var rightImg = createPageImg(currentPage + 1);
                        spread.appendChild(rightImg);
                        pageIndicator.innerText = currentPage + '-' + (currentPage + 1) + ' / ' + totalPages;
                    } else {
                        pageIndicator.innerText = currentPage + ' / ' + totalPages;
                    }
                    readerView.appendChild(spread);
                }

                var progress = (currentPage / totalPages) * 100;
                progressBar.style.width = progress + '%';
            }, directionClass ? 300 : 0);
        }

        function createPageImg(num) {
            var img = document.createElement('img');
            img.src = 'caps/' + num + '.png';
            img.alt = 'Página ' + num;
            img.className = 'page-image';
            img.loading = 'lazy';
            img.onerror = function () {
                img.alt = 'Página ' + num + ' no disponible';
                img.style.background = '#111';
                img.style.minWidth = '300px';
                img.style.minHeight = '400px';
            };
            return img;
        }

        function nextPage() {
            var step = isMobile() ? 1 : 2;
            if (currentPage + step <= totalPages) {
                currentPage += step;
                renderPages('turn-next');
            } else if (!isMobile() && currentPage + 1 === totalPages) {
                currentPage = totalPages;
                renderPages('turn-next');
            } else {
                // Show CTA when reaching the end
                document.getElementById('cta-overlay').classList.add('active');
            }
        }

        function closeCTA() {
            document.getElementById('cta-overlay').classList.remove('active');
        }

        function prevPage() {
            var step = isMobile() ? 1 : 2;
            if (currentPage - step >= 1) {
                currentPage -= step;
                renderPages('turn-prev');
            } else {
                currentPage = 1;
                renderPages('turn-prev');
            }
        }

        // Atajos de teclado
        window.addEventListener('keydown', function (e) {
            if (e.key === 'ArrowRight' || e.key === ' ') nextPage();
            if (e.key === 'ArrowLeft') prevPage();
            if (e.key === 'm' || e.key === 'Escape') toggleUI();
        });

        // Swipe para móvil
        var touchStartX = 0;
        document.addEventListener('touchstart', function (e) { touchStartX = e.changedTouches[0].screenX; }, false);
        document.addEventListener('touchend', function (e) {
            var touchEndX = e.changedTouches[0].screenX;
            var diff = touchStartX - touchEndX;
            if (Math.abs(diff) > 60) {
                if (diff > 0) nextPage();
                else prevPage();
            }
        }, false);

        window.addEventListener('resize', function () { renderPages(); });

        // Carga inicial
        renderPages();
    </script>
</body>

</html>